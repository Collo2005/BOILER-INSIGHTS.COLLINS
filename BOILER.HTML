<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boiler Performance Test Lab Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Visualization & Content Choices:
    - Report Info: Introduction, Objectives, Theory, Apparatus, Procedure, Discussion, Conclusion, References. Goal: Inform. Viz/Method: HTML text, lists, styled formulas. Interaction: None or simple hovers. Justification: Standard way to present textual report information.
    - Report Info: Results Data Table. Goal: Inform, Compare. Viz/Method: HTML table. Interaction: Hover highlight. Justification: Clear presentation of raw experimental data.
    - Report Info: P1 vs Time, T1 vs Time from data table. Goal: Change, Observe Trends. Viz/Method: Chart.js Line Charts. Interaction: Tooltips. Justification: Visualizing trends in key parameters over time.
    - Report Info: Boiler Efficiency Calculation (Direct Method). Goal: Inform, Interact, Calculate. Viz/Method: HTML form inputs, JS calculation, display result. Interaction: User selects stage/inputs values. Justification: Allows user to apply theoretical formula to experimental data (or user-defined data due to report data issues).
    - NEW LLM Feature: Section Summarizer. Goal: Inform, Summarize. Viz/Method: Button, LLM API call, display summary text. Interaction: Click to summarize. Justification: Quick content digestion.
    - NEW LLM Feature: Boiler Insights Chatbot. Goal: Inform, Q&A, Explore. Viz/Method: Button, Modal chat interface, LLM API call for conversational responses. Interaction: Click to open, type questions, receive answers. Justification: Provides dynamic, context-aware assistance for understanding boiler concepts and data.
    - CONFIRMING NO SVG/Mermaid. All visuals via HTML/CSS/Tailwind or Chart.js Canvas. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-button { transition: all 0.3s ease; }
        .tab-button.active { border-color: #0D9488; background-color: #0D9488; color: white; }
        .tab-button:not(.active):hover { background-color: #F5F5F4; } /* neutral-100 */
        .formula { font-family: 'Times New Roman', serif; font-style: italic; margin: 0.5rem 0; padding: 0.5rem; background-color: #FEF3C7; border-left: 3px solid #FCD34D; } /* amber-100, amber-400 */
        .chart-container { position: relative; width: 100%; max-width: 700px; margin-left: auto; margin-right: auto; height: 300px; max-height: 350px; }
        @media (min-width: 768px) { .chart-container { height: 350px; max-height: 400px;} }
        table th, table td { border: 1px solid #D4D4D4; padding: 8px; text-align: left; } /* neutral-300 */
        table th { background-color: #F5F5F5; } /* neutral-100 */
        .section-intro { margin-bottom: 1rem; font-style: italic; color: #525252; } /* neutral-600 */

        /* Modal specific styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb; /* neutral-200 */
        }
        .chat-message {
            margin-bottom: 0.75rem;
            display: flex;
            flex-direction: column;
        }
        .chat-message.user {
            align-items: flex-end;
        }
        .chat-message.ai {
            align-items: flex-start;
        }
        .chat-bubble {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            line-height: 1.4;
        }
        .chat-message.user .chat-bubble {
            background-color: #BFDBFE; /* blue-200 */
            color: #1F2937; /* neutral-800 */
        }
        .chat-message.ai .chat-bubble {
            background-color: #E0F2F7; /* teal-50 */
            color: #1F2937; /* neutral-800 */
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #0D9488; /* teal-600 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-amber-50 text-neutral-700 antialiased">

    <header class="bg-teal-700 text-white p-6 shadow-md">
        <div class="container mx-auto max-w-5xl flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold">Performance Test of Boiler Lab Report</h1>
                <p class="text-lg">COLLINS M MWANIKI</p>
                <p class="text-sm">Murang'a University of Technology</p>
            </div>
            <button onclick="openBoilerInsights()" class="bg-teal-600 hover:bg-teal-800 text-white font-semibold py-2 px-4 rounded-md shadow transition duration-150 ease-in-out flex items-center space-x-2">
                <span>Boiler Insights ✨</span>
            </button>
        </div>
    </header>

    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto max-w-5xl flex justify-center space-x-1 sm:space-x-2 p-3 overflow-x-auto">
            <button class="tab-button active text-sm sm:text-base px-3 py-2 sm:px-4 sm:py-2 font-medium rounded-md border-2 border-transparent" onclick="showTab('introduction', this)">Introduction</button>
            <button class="tab-button text-sm sm:text-base px-3 py-2 sm:px-4 sm:py-2 font-medium rounded-md border-2 border-transparent" onclick="showTab('objectivesTheory', this)">Objectives & Theory</button>
            <button class="tab-button text-sm sm:text-base px-3 py-2 sm:px-4 sm:py-2 font-medium rounded-md border-2 border-transparent" onclick="showTab('methodology', this)">Methodology</button>
            <button class="tab-button text-sm sm:text-base px-3 py-2 sm:px-4 sm:py-2 font-medium rounded-md border-2 border-transparent" onclick="showTab('resultsAnalysis', this)">Results & Analysis</button>
            <button class="tab-button text-sm sm:text-base px-3 py-2 sm:px-4 sm:py-2 font-medium rounded-md border-2 border-transparent" onclick="showTab('discussionConclusion', this)">Discussion & Conclusion</button>
        </div>
    </nav>

    <main class="container mx-auto max-w-5xl p-4 sm:p-6">
        <div id="introduction" class="tab-content space-y-4">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-semibold text-teal-700 border-b-2 border-amber-300 pb-2 flex-grow">Introduction</h2>
                <button onclick="summarizeSection('introduction')" class="ml-4 bg-amber-400 hover:bg-amber-500 text-white text-sm py-1 px-3 rounded-md shadow transition duration-150 ease-in-out flex items-center space-x-1">
                    <span>Summarize Section ✨</span>
                </button>
            </div>
            <div id="summary-introduction" class="summary-output bg-blue-100 p-3 rounded-md text-sm italic hidden"></div>
            <div id="loading-introduction" class="loading-spinner hidden mx-auto my-4"></div>
            <p class="section-intro">This section provides an overview of boilers and the significance of performance testing in thermal energy systems. Understanding boiler performance is crucial for efficiency, safety, and cost-effectiveness.</p>
            <p>Boilers play a critical role in energy systems by converting water into steam through the application of heat. This steam can then be used for power generation, heating, or industrial processes. The performance of a boiler directly influences the overall efficiency, safety, and operational cost of thermal systems. A boiler performance test is conducted to evaluate key parameters such as steam generation rate, heat input, thermal efficiency, fuel consumption, and steam quality under controlled operating conditions. These tests are essential for verifying that the boiler meets design specifications, complies with regulatory standards, and operates reliably under load. They also help identify areas for improvement, such as heat losses or incomplete combustion. In this experiment, a performance test was carried out to assess the boiler's thermal behavior by monitoring parameters including temperature, pressure, enthalpy, and steam dryness fraction. The collected data provides insight into the heat transfer and efficiency of the boiler system.</p>
        </div>

        <div id="objectivesTheory" class="tab-content hidden space-y-4">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-semibold text-teal-700 border-b-2 border-amber-300 pb-2 flex-grow">Objectives & Theory</h2>
                <button onclick="summarizeSection('objectivesTheory')" class="ml-4 bg-amber-400 hover:bg-amber-500 text-white text-sm py-1 px-3 rounded-md shadow transition duration-150 ease-in-out flex items-center space-x-1">
                    <span>Summarize Section ✨</span>
                </button>
            </div>
            <div id="summary-objectivesTheory" class="summary-output bg-blue-100 p-3 rounded-md text-sm italic hidden"></div>
            <div id="loading-objectivesTheory" class="loading-spinner hidden mx-auto my-4"></div>
            <p class="section-intro">Here, we outline the main goals of the experiment and the fundamental theoretical principles underpinning boiler performance evaluation, including key formulas for efficiency and evaporation.</p>
            
            <h3 class="text-xl font-medium text-teal-600">Objectives</h3>
            <ul class="list-disc list-inside space-y-1 pl-4">
                <li>To operate a boiler and find the quantity of steam generated, steam pressure, and boiler efficiency.</li>
                <li>To gain practical experience and basic practice in boiler operation.</li>
                <li>To analyze the heat transfer characteristics by monitoring temperature variations at different points within the system.</li>
                <li>To identify potential inefficiencies or heat losses within the system and suggest areas for improvement in boiler operation.</li>
                <li>To determine the rate of steam generation and assess whether the boiler meets its rated capacity under the given operating conditions.</li>
            </ul>

            <h3 class="text-xl font-medium text-teal-600">Theory</h3>
            <p>The performance test of a boiler is conducted to evaluate how efficiently it operates under actual working conditions. This kind of test provides valuable insight into the operational state of the boiler and serves as a basis for making performance improvements. Two main parameters are typically used to assess boiler performance: boiler efficiency and evaporation ratio.</p>
            <p><strong class="font-semibold">Boiler Efficiency:</strong> Refers to how effectively the boiler converts the chemical energy in fuel into useful heat energy for generating steam. It is expressed as a percentage.</p>
            <div class="formula">Boiler Efficiency (%) = (Heat Output / Heat Input) × 100</div>
            <p>A higher efficiency percentage means that the boiler is better at utilizing fuel with minimal losses, which is both economically and environmentally beneficial.</p>
            
            <p><strong class="font-semibold">Evaporation Ratio:</strong> Indicates how much steam is produced for every kilogram of fuel burned.</p>
            <div class="formula">Evaporation Ratio = Mass of Steam Generated (kg) / Mass of Fuel Consumed (kg)</div>
            <p>This ratio helps in understanding the boiler's steam generation capacity relative to its fuel usage. A higher evaporation ratio reflects more effective fuel usage and better boiler performance.</p>

            <p><strong class="font-semibold">Equivalent Evaporation:</strong> To standardize performance comparisons across boilers operating at different conditions, the concept of equivalent evaporation is used. It expresses performance in terms of how much steam the boiler would produce under standard conditions (water at 100°C, atmospheric pressure 1.01325 bar) using the same amount of heat as under actual conditions. The latent heat of vaporization under standard conditions is 2256.9 kJ/kg.</p>
            <div class="formula">Equivalent Evaporation (m<sub>e</sub>) = H<sub>1</sub> / 2256.9</div>
            <p>Where H<sub>1</sub> is the actual heat absorbed by the water to generate steam (in kJ per kg of fuel).</p>
        </div>

        <div id="methodology" class="tab-content hidden space-y-4">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-semibold text-teal-700 border-b-2 border-amber-300 pb-2 flex-grow">Methodology</h2>
                <button onclick="summarizeSection('methodology')" class="ml-4 bg-amber-400 hover:bg-amber-500 text-white text-sm py-1 px-3 rounded-md shadow transition duration-150 ease-in-out flex items-center space-x-1">
                    <span>Summarize Section ✨</span>
                </button>
            </div>
            <div id="summary-methodology" class="summary-output bg-blue-100 p-3 rounded-md text-sm italic hidden"></div>
            <div id="loading-methodology" class="loading-spinner hidden mx-auto my-4"></div>
            <p class="section-intro">This section details the equipment used for the experiment and the step-by-step procedure followed to conduct the boiler performance test, including how data was collected at various operational stages.</p>

            <h3 class="text-xl font-medium text-teal-600">Apparatus</h3>
            <ul class="list-disc list-inside space-y-1 pl-4">
                <li>Thermometer</li>
                <li>Pressure gauge</li>
                <li>Boiler</li>
                <li>Water meter</li>
                <li>Fuel meter</li>
            </ul>

            <h3 class="text-xl font-medium text-teal-600">Procedure</h3>
            <ol class="list-decimal list-inside space-y-2 pl-4">
                <li>The experiment was initiated by ensuring that all equipment and measurement devices (pressure and temperature sensors, fuel flow meter, water flow meter) were calibrated and functioning correctly.</li>
                <li>The boiler was allowed to reach steady-state operating conditions before beginning data collection.</li>
                <li>Steam valve 1 (SV-1) and Steam valve 2 (SV-2) were fully opened to allow uninterrupted steam flow. It was confirmed that the steam at the boiler outlet was in the saturated vapor phase by referencing the Mollier diagram. This condition was maintained throughout.</li>
                <li>The steam flow was adjusted in three distinct stages by varying the opening of the Steam Distribution Valve (SDV).</li>
                <li>At each SDV setting, data was recorded five times at two-minute intervals over a total duration of ten minutes.</li>
                <li>During each interval, boiler outlet pressure and temperature, steam flow rate, fuel flow rate, and water flow rate were carefully noted.</li>
                <li>To accurately determine the amount of fuel and water consumed during each stage, readings from the fuel flow meter and water flow meter were recorded at the beginning and end of each ten-minute interval.</li>
                <li>This procedure was repeated for low, medium, and high steam flow rates, ensuring the steam condition at the boiler outlet remained within the saturated vapor region. Any deviation was corrected before continuing.</li>
                <li>Upon completion of data collection at all three flow rates, SV-1 and SV-2 were gradually closed according to standard safety protocols, and final measurements were taken.</li>
            </ol>
        </div>

        <div id="resultsAnalysis" class="tab-content hidden space-y-6">
            <h2 class="text-2xl font-semibold text-teal-700 border-b-2 border-amber-300 pb-2">Results & Analysis</h2>
            <p class="section-intro">Explore the experimental data collected during the boiler performance test. This section includes the raw data table, interactive charts visualizing key parameters, and a calculator to determine boiler efficiency.</p>

            <h3 class="text-xl font-medium text-teal-600">Experimental Data Table</h3>
            <p>The following table presents the data recorded during the experiment. Note: "Boiler Flow" and "Fuel Flow" are cumulative meter readings in Liters. Some values in the original report were missing or unclear; interpretations are made where necessary.</p>
            <div class="overflow-x-auto bg-white p-3 rounded-lg shadow">
                <table class="min-w-full text-sm">
                    <thead>
                        <tr>
                            <th>Time (Min)</th>
                            <th>P1 (kg/cm²)</th>
                            <th>T1 (°C)</th>
                            <th>T2 (°C)</th>
                            <th>Boiler Flow (L)</th>
                            <th>Fuel Flow (L)</th>
                            <th>SDV (%)</th>
                            <th>Δh (kJ/kg)</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                    </tbody>
                </table>
            </div>
            
            <h3 class="text-xl font-medium text-teal-600 mt-6">Interactive Charts</h3>
            <p>Visualize the trends of key parameters recorded over the duration of the experiment.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="text-lg font-medium text-center mb-2">Boiler Outlet Pressure (P1) vs. Time</h4>
                    <div class="chart-container"><canvas id="pressureChart"></canvas></div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="text-lg font-medium text-center mb-2">Boiler Outlet Temperature (T1) vs. Time</h4>
                    <div class="chart-container"><canvas id="temperatureChart"></canvas></div>
                </div>
            </div>

            <h3 class="text-xl font-medium text-teal-600 mt-6">Boiler Efficiency Calculator (Direct Method)</h3>
            <p>Calculate the boiler efficiency using the direct method based on the experimental data. The formula is: Efficiency (%) = (Mass of Steam × Δh) / (Mass of Fuel × GCV) × 100.</p>
            <p class="text-sm text-orange-600"><strong>Important Note on Δh:</strong> The Δh values (enthalpy added to water) provided in the lab report (3.125 - 3.75 kJ/kg) are unusually low. Typical values for steam generation are in the range of 2000-2500 kJ/kg. Using the report's Δh values will result in very low efficiency. For a more realistic calculation, consider inputting a typical Δh value.</p>
            
            <div class="bg-white p-6 rounded-lg shadow space-y-4">
                <div>
                    <label for="calculationStage" class="block text-sm font-medium text-neutral-700">Select Data Interval for Consumption:</label>
                    <select id="calculationStage" class="mt-1 block w-full p-2 border border-neutral-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500">
                        <option value="stage1">Interval 1 (0-10 minutes)</option>
                        <option value="stage2">Interval 2 (10-20 minutes)</option>
                        <option value="stage3">Interval 3 (20-30 minutes)</option>
                    </select>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium">Water Consumed (L):</label>
                        <input type="text" id="waterConsumed" class="mt-1 block w-full p-2 border bg-neutral-100 border-neutral-300 rounded-md" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium">Fuel Consumed (L):</label>
                        <input type="text" id="fuelConsumed" class="mt-1 block w-full p-2 border bg-neutral-100 border-neutral-300 rounded-md" readonly>
                    </div>
                </div>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="deltaH" class="block text-sm font-medium">Δh (Enthalpy added to water, kJ/kg):</label>
                        <input type="number" id="deltaH" value="3.5" step="0.001" class="mt-1 block w-full p-2 border border-neutral-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500">
                        <p class="text-xs text-neutral-500">Default is an average from report data. Consider typical values (e.g., 2200 kJ/kg).</p>
                    </div>
                    <div>
                        <label for="gcvFuel" class="block text-sm font-medium">Fuel GCV (kJ/kg):</label>
                        <input type="number" id="gcvFuel" value="42000" class="mt-1 block w-full p-2 border border-neutral-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500">
                         <p class="text-xs text-neutral-500">E.g., Diesel ~45000, Light Oil ~42000.</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="waterDensity" class="block text-sm font-medium">Water Density (kg/L):</label>
                        <input type="number" id="waterDensity" value="1" step="0.01" class="mt-1 block w-full p-2 border border-neutral-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500">
                    </div>
                    <div>
                        <label for="fuelDensity" class="block text-sm font-medium">Fuel Density (kg/L):</label>
                        <input type="number" id="fuelDensity" value="0.85" step="0.01" class="mt-1 block w-full p-2 border border-neutral-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500">
                         <p class="text-xs text-neutral-500">E.g., Diesel ~0.85.</p>
                    </div>
                </div>
                <button onclick="calculateEfficiency()" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-4 rounded-md shadow transition duration-150 ease-in-out">Calculate Efficiency</button>
                <div id="efficiencyResult" class="mt-4 text-lg font-semibold text-center p-3 bg-amber-100 rounded-md">Efficiency: --%</div>
            </div>
        </div>

        <div id="discussionConclusion" class="tab-content hidden space-y-4">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-semibold text-teal-700 border-b-2 border-amber-300 pb-2 flex-grow">Discussion & Conclusion</h2>
                <button onclick="summarizeSection('discussionConclusion')" class="ml-4 bg-amber-400 hover:bg-amber-500 text-white text-sm py-1 px-3 rounded-md shadow transition duration-150 ease-in-out flex items-center space-x-1">
                    <span>Summarize Section ✨</span>
                </button>
            </div>
            <div id="summary-discussionConclusion" class="summary-output bg-blue-100 p-3 rounded-md text-sm italic hidden"></div>
            <div id="loading-discussionConclusion" class="loading-spinner hidden mx-auto my-4"></div>
            <p class="section-intro">This final section summarizes the key findings from the experiment, discusses their implications for boiler operation, and concludes on the importance of performance testing.</p>
            
            <h3 class="text-xl font-medium text-teal-600">Discussion</h3>
            <p>The performance test provided valuable insight into how the boiler responds under various operating conditions. By collecting and analyzing data such as steam pressure, outlet temperature, feedwater temperature, and the volume of fuel and water used over time, we were able to observe how the boiler handles different loads and steam flow rates.</p>
            <p>From the recorded values, noticeable changes in key parameters, particularly boiler pressure and fuel flow rate, were observed. These changes reflect how the system adjusts to different steam demands. As the steam demand increases, more fuel is consumed, and the temperature inside the boiler also rises to maintain steam output. Such behavior is expected, but large fluctuations could indicate areas where control systems or operator input might need fine-tuning for more consistent performance.</p>
            <p>One important aspect of the test was the change in SDV (Steam Distribution Valve) settings. Adjusting this valve changed the steam flow rate, which helped simulate different load conditions. The corresponding data showed how the system responded to these changes. We also recorded Δh, which represents the change in enthalpy for the amount of energy added to the water to convert it into steam. This value (as reported) appeared to increase with load, confirming that more energy was being transferred at higher steam outputs, though the absolute values reported for Δh are significantly lower than typical thermodynamic values for steam generation.</p>
            <p>To assess how efficiently the boiler converts fuel into usable steam, thermal efficiency can be calculated using the direct method: η = (Heat Output (steam)) / (Heat Input (fuel)) × 100. For a more comprehensive understanding, further analysis like heat loss analysis (examining flue gas composition and temperature), stability of operation (addressing pressure/temperature fluctuations), and comparison with design specifications would be beneficial.</p>

            <h3 class="text-xl font-medium text-teal-600">Conclusion</h3>
            <p>In conclusion, the performance test of a boiler plays a crucial role in evaluating and optimizing its efficiency, reliability, and compliance with regulatory standards. By measuring key parameters and analyzing the results, engineers can identify any inefficiencies or malfunctions, enabling them to make informed decisions to improve the boiler's performance.</p>
            <p>The test provides valuable insights into factors such as fuel consumption, thermal efficiency, emissions, and overall operational behavior, allowing for adjustments and maintenance to enhance energy efficiency, reduce emissions, and ensure safe operation. Regular testing of boilers is essential for maintaining optimal performance, extending their lifespan, and minimizing operational costs. It serves as a valuable tool in achieving energy efficiency goals, meeting environmental regulations, and ensuring the smooth and efficient operation of boiler systems in various industrial and residential settings.</p>
        </div>
    </main>

    <footer class="text-center p-4 mt-8 text-sm text-neutral-500 border-t border-neutral-200">
        Interactive Report generated from Lab Data.
    </footer>

    <div id="boilerInsightsModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center bg-teal-700 text-white p-4 rounded-t-md">
                <h3 class="text-lg font-semibold">Boiler Insights Chatbot ✨</h3>
                <button onclick="closeBoilerInsights()" class="text-white hover:text-gray-200 text-2xl leading-none">&times;</button>
            </div>
            <div id="chatMessages" class="chat-messages flex flex-col-reverse">
                <div class="chat-message ai">
                    <div class="chat-bubble">Hello! I'm your Boiler Insights Chatbot. Ask me anything about boiler performance, data, or related concepts.</div>
                </div>
            </div>
            <div class="p-4 flex items-center space-x-2">
                <input type="text" id="chatInput" placeholder="Ask a question..." class="flex-grow p-2 border border-neutral-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
                <button onclick="sendMessage()" class="bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-4 rounded-md shadow transition duration-150 ease-in-out">Send</button>
            </div>
            <div id="chatLoading" class="loading-spinner hidden mx-auto my-2"></div>
        </div>
    </div>

    <script>
        const reportData = [
            { time: 0, p1: 6.5, t1: 136.0, t2: 23.0, boilerFlow: 7220.2, fuelFlow: 33925, sdv: 1, delta_h: 3.75 },
            { time: 2, p1: null, t1: 144.3, t2: 23.0, boilerFlow: null, fuelFlow: null, sdv: 15, delta_h: null },
            { time: 4, p1: 3.25, t1: 140.3, t2: 22.9, boilerFlow: null, fuelFlow: null, sdv: 58, delta_h: 3.25 },
            { time: 6, p1: null, t1: 138.4, t2: 22.9, boilerFlow: null, fuelFlow: null, sdv: 68, delta_h: 3.125 },
            { time: 8, p1: 3.125, t1: 137.4, t2: 22.9, boilerFlow: null, fuelFlow: null, sdv: 55, delta_h: 3.125 },
            { time: 10, p1: 3.125, t1: 137.2, t2: 23.0, boilerFlow: 7221.8, fuelFlow: 34042, sdv: 37, delta_h: null },
            { time: 12, p1: 3.25, t1: 132.9, t2: 22.4, boilerFlow: null, fuelFlow: null, sdv: 70, delta_h: null },
            { time: 14, p1: 3.75, t1: 134.6, t2: 22.9, boilerFlow: null, fuelFlow: null, sdv: 72, delta_h: null },
            { time: 16, p1: 3.875, t1: 138.5, t2: 22.9, boilerFlow: null, fuelFlow: null, sdv: 26, delta_h: null },
            { time: 18, p1: 4.0, t1: 136.2, t2: 22.9, boilerFlow: null, fuelFlow: null, sdv: 26, delta_h: null },
            { time: 20, p1: 4.0, t1: 136.9, t2: 22.8, boilerFlow: 7223.3, fuelFlow: 34169, sdv: 73, delta_h: null },
            { time: 22, p1: 4.0, t1: 136.6, t2: 22.9, boilerFlow: null, fuelFlow: null, sdv: 64, delta_h: null },
            { time: 24, p1: 4.0, t1: 136.7, t2: 22.9, boilerFlow: null, fuelFlow: null, sdv: 64, delta_h: null },
            { time: 26, p1: 4.0, t1: 136.8, t2: 22.8, boilerFlow: null, fuelFlow: null, sdv: 66, delta_h: null },
            { time: 28, p1: 4.125, t1: 137.3, t2: 22.9, boilerFlow: null, fuelFlow: null, sdv: 71, delta_h: null }, // Original T2 was 27.4, using 22.9 for consistency
            { time: 30, p1: 4.125, t1: 138.0, t2: 22.9, boilerFlow: 7224.82, fuelFlow: 34264, sdv: 70, delta_h: null }
        ];

        const stageData = {
            stage1: { // 0-10 min
                water_L: (reportData[5].boilerFlow - reportData[0].boilerFlow).toFixed(2),
                fuel_L: (reportData[5].fuelFlow - reportData[0].fuelFlow).toFixed(2)
            },
            stage2: { // 10-20 min
                water_L: (reportData[10].boilerFlow - reportData[5].boilerFlow).toFixed(2),
                fuel_L: (reportData[10].fuelFlow - reportData[5].fuelFlow).toFixed(2)
            },
            stage3: { // 20-30 min
                water_L: (reportData[15].boilerFlow - reportData[10].boilerFlow).toFixed(2),
                fuel_L: (reportData[15].fuelFlow - reportData[10].fuelFlow).toFixed(2)
            }
        };

        let chatHistory = [{ role: "model", parts: [{ text: "Hello! I'm your Boiler Insights Chatbot. Ask me anything about boiler performance, data, or related concepts." }] }];

        function showTab(tabId, element) {
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');

            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));
            if (element) {
                element.classList.add('active');
            }
        }

        function populateTable() {
            const tbody = document.getElementById('dataTableBody');
            reportData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.time}</td>
                    <td>${row.p1 !== null ? row.p1 : 'N/A'}</td>
                    <td>${row.t1 !== null ? row.t1 : 'N/A'}</td>
                    <td>${row.t2 !== null ? row.t2 : 'N/A'}</td>
                    <td>${row.boilerFlow !== null ? row.boilerFlow : 'N/A'}</td>
                    <td>${row.fuelFlow !== null ? row.fuelFlow : 'N/A'}</td>
                    <td>${row.sdv !== null ? row.sdv : 'N/A'}</td>
                    <td>${row.delta_h !== null ? row.delta_h : 'N/A'}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function createCharts() {
            const pressureCtx = document.getElementById('pressureChart').getContext('2d');
            new Chart(pressureCtx, {
                type: 'line',
                data: {
                    labels: reportData.map(d => d.time),
                    datasets: [{
                        label: 'P1 (kg/cm²)',
                        data: reportData.map(d => d.p1),
                        borderColor: '#0D9488', // teal-600
                        tension: 0.1,
                        fill: false,
                        spanGaps: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: false, title: { display: true, text: 'Pressure (kg/cm²)'}}, x: {title: { display: true, text: 'Time (min)'}}}
                }
            });

            const temperatureCtx = document.getElementById('temperatureChart').getContext('2d');
            new Chart(temperatureCtx, {
                type: 'line',
                data: {
                    labels: reportData.map(d => d.time),
                    datasets: [{
                        label: 'T1 (°C) - Outlet Temp',
                        data: reportData.map(d => d.t1),
                        borderColor: '#F59E0B', // amber-500
                        tension: 0.1,
                        fill: false,
                        spanGaps: true
                    },
                    {
                        label: 'T2 (°C) - Feedwater Temp',
                        data: reportData.map(d => d.t2),
                        borderColor: '#3B82F6', // blue-500
                        tension: 0.1,
                        fill: false,
                        spanGaps: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: false, title: { display: true, text: 'Temperature (°C)'}}, x: {title: { display: true, text: 'Time (min)'}}}
                }
            });
        }

        function updateCalculatorInputs() {
            const selectedStage = document.getElementById('calculationStage').value;
            document.getElementById('waterConsumed').value = stageData[selectedStage].water_L;
            document.getElementById('fuelConsumed').value = stageData[selectedStage].fuel_L;
        }
        
        document.getElementById('calculationStage').addEventListener('change', updateCalculatorInputs);

        function calculateEfficiency() {
            const water_L = parseFloat(document.getElementById('waterConsumed').value);
            const fuel_L = parseFloat(document.getElementById('fuelConsumed').value);
            const deltaH = parseFloat(document.getElementById('deltaH').value);
            const gcvFuel = parseFloat(document.getElementById('gcvFuel').value);
            const waterDensity = parseFloat(document.getElementById('waterDensity').value);
            const fuelDensity = parseFloat(document.getElementById('fuelDensity').value);

            if (isNaN(water_L) || isNaN(fuel_L) || isNaN(deltaH) || isNaN(gcvFuel) || isNaN(waterDensity) || isNaN(fuelDensity) || gcvFuel <= 0 || fuel_L <=0 || fuelDensity <=0 ) {
                document.getElementById('efficiencyResult').textContent = 'Error: Invalid input values.';
                return;
            }

            const massSteam_kg = water_L * waterDensity;
            const massFuel_kg = fuel_L * fuelDensity;

            const heatOutput = massSteam_kg * deltaH;
            const heatInput = massFuel_kg * gcvFuel;

            if (heatInput === 0) {
                document.getElementById('efficiencyResult').textContent = 'Error: Heat input cannot be zero.';
                return;
            }
            
            const efficiency = (heatOutput / heatInput) * 100;
            document.getElementById('efficiencyResult').textContent = `Efficiency: ${efficiency.toFixed(2)}%`;
        }

        async function summarizeSection(sectionId) {
            const sectionElement = document.getElementById(sectionId);
            const summaryOutput = document.getElementById(`summary-${sectionId}`);
            const loadingSpinner = document.getElementById(`loading-${sectionId}`);

            summaryOutput.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');

            const sectionText = sectionElement.innerText;
            const prompt = `Summarize the following text concisely:\n\n${sectionText}`;

            try {
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    summaryOutput.textContent = text;
                    summaryOutput.classList.remove('hidden');
                } else {
                    summaryOutput.textContent = 'Could not generate summary.';
                    summaryOutput.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error summarizing section:', error);
                summaryOutput.textContent = 'Error summarizing section. Please try again.';
                summaryOutput.classList.remove('hidden');
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        }

        function openBoilerInsights() {
            document.getElementById('boilerInsightsModal').classList.remove('hidden');
            const chatMessagesDiv = document.getElementById('chatMessages');
            chatMessagesDiv.innerHTML = ''; // Clear previous messages
            chatHistory.forEach(msg => displayMessage(msg.parts[0].text, msg.role));
            chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight; // Scroll to bottom
            document.getElementById('chatInput').focus();
        }

        function closeBoilerInsights() {
            document.getElementById('boilerInsightsModal').classList.add('hidden');
        }

        function displayMessage(text, sender) {
            const chatMessagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-message', sender);
            const bubbleDiv = document.createElement('div');
            bubbleDiv.classList.add('chat-bubble');
            bubbleDiv.textContent = text;
            messageDiv.appendChild(bubbleDiv);
            chatMessagesDiv.prepend(messageDiv); // Add to top for reverse-flex
            chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight; // Scroll to bottom
        }

        async function sendMessage() {
            const chatInput = document.getElementById('chatInput');
            const userMessage = chatInput.value.trim();
            if (!userMessage) return;

            displayMessage(userMessage, 'user');
            chatHistory.push({ role: "user", parts: [{ text: userMessage }] });
            chatInput.value = '';

            const chatLoading = document.getElementById('chatLoading');
            chatLoading.classList.remove('hidden');

            try {
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const aiResponse = result.candidates[0].content.parts[0].text;
                    displayMessage(aiResponse, 'ai');
                    chatHistory.push({ role: "model", parts: [{ text: aiResponse }] });
                } else {
                    displayMessage('Error: Could not get a response from the AI.', 'ai');
                }
            } catch (error) {
                console.error('Error sending message to AI:', error);
                displayMessage('Error: Failed to connect to the AI. Please try again.', 'ai');
            } finally {
                chatLoading.classList.add('hidden');
                document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
            }
        }

        document.getElementById('chatInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        window.onload = () => {
            populateTable();
            createCharts();
            updateCalculatorInputs(); // Initialize calculator inputs for the default stage
            // Get the first tab button and pass it to showTab for initial activation
            const firstTabButton = document.querySelector('.tab-button');
            showTab('introduction', firstTabButton);
        };
    </script>
</body>
</html>
